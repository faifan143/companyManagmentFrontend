(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{8608:function(e,s,r){Promise.resolve().then(r.bind(r,7017))},7017:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return x}});var t=r(7437),a=r(4245);let o=a.Ry().shape({email:a.Z_().email("Invalid email address").required("Email is required"),password:a.Z_().min(3,"Password must be at least 6 characters").required("Password is required")}),n=a.Ry().shape({newPassword:a.Z_().min(6,"Password must be at least 6 characters").required("New password is required"),confirmPassword:a.Z_().oneOf([a.iH("newPassword"),void 0],"Passwords must match").required("Confirm password is required")});var l=r(7753),i=r(8472),c=r(2265),d=r(9343),u=r(7583),m=r.n(u),p=e=>{let{isModalOpen:s,setIsModalOpen:r,empId:a}=e,{register:o,handleSubmit:c,formState:{errors:u}}=(0,d.cI)({resolver:(0,l.X)(n)}),p=async e=>{try{let s=await i.Z.post("http://".concat("ec2-35-173-139-149.compute-1.amazonaws.com","/auth/change-password/").concat(a),{newPassword:e.newPassword});console.log(s.data),r(!1)}catch(e){console.error("Error changing password",e)}};return(0,t.jsx)(m(),{isOpen:s,onRequestClose:()=>r(!1),ariaHideApp:!1,contentLabel:"Change Password",className:"fixed inset-0 flex items-center justify-center",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",children:(0,t.jsxs)("div",{className:"bg-white p-8 rounded-xl shadow-lg max-w-md w-full relative",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Change Password"}),(0,t.jsxs)("form",{onSubmit:c(p),children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block  text-sm font-medium",children:"New Password"}),(0,t.jsx)("input",{type:"password",...o("newPassword"),className:"w-full px-4 py-2 mt-1 rounded-lg    focus:outline-none focus:ring-2 focus:ring-accent border ".concat(u.newPassword?"border-red-600":"border-[#1b1a40]"),placeholder:"Enter new password"}),u.newPassword&&(0,t.jsx)("p",{className:"text-red-600 mt-1 text-sm",children:u.newPassword.message})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("label",{className:"block  text-sm font-medium",children:"Confirm Password"}),(0,t.jsx)("input",{type:"password",...o("confirmPassword"),className:"w-full px-4 py-2 mt-1 rounded-lg    focus:outline-none focus:ring-2 focus:ring-accent border ".concat(u.confirmPassword?"border-red-600":"border-[#1b1a40]"),placeholder:"Confirm new password"}),u.confirmPassword&&(0,t.jsx)("p",{className:"text-red-600 mt-1 text-sm",children:u.confirmPassword.message})]}),(0,t.jsx)("button",{type:"submit",className:"w-full py-2 mt-4 bg-[#413d99] text-white rounded-lg font-bold hover:bg-opacity-90 transition duration-200",children:"Change Password"})]}),(0,t.jsx)("button",{onClick:()=>r(!1),className:"absolute top-2 right-2 text-gray-700 hover:text-red-500",children:"\xd7"})]})})},h=r(6992),f=r(6463),w=r(5730),g=r(9671),x=()=>{let{dispatchAction:e,selector:s}=(0,w.Sc)(e=>e.user),{loading:r,error:a,isAuthenticated:n}=s,i=(0,f.useRouter)(),[u,m]=(0,c.useState)(!1),[x,b]=(0,c.useState)(""),[y,v]=(0,c.useState)({open:!1,message:"",severity:"success"}),{register:j,handleSubmit:k,formState:{errors:N}}=(0,d.cI)({resolver:(0,l.X)(o)}),P=async s=>{try{let r=await e(h.pH,s).unwrap();console.log("Login successful",r),v({open:!0,message:"Login successful!",severity:"success"})}catch(e){b(e.split(",")[1]),e.startsWith("You must change your password on the first login")?m(!0):(console.error("Login failed",e),v({open:!0,message:"Login failed. Please check your credentials.",severity:"error"}))}};return(0,c.useEffect)(()=>{n&&i.replace("/home")},[n,i]),(0,t.jsxs)("div",{className:"flex items-center justify-center min-h-screen bg-white",children:[(0,t.jsxs)("div",{className:"backdrop-blur-md bg-gray-200 p-10 rounded-xl shadow-xl max-w-sm w-full",children:[(0,t.jsx)("h1",{className:"text-center text-2xl text-[#1b1a40] font-bold mb-6",children:"Company Managment System"}),(0,t.jsxs)("form",{className:"space-y-4",onSubmit:k(P),children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Email"}),(0,t.jsx)("input",{type:"email",...j("email"),className:"w-full px-4 py-2 mt-1 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent border ".concat(N.email?"border-red-600":"border-[#1b1a40]"),placeholder:"Enter your email"}),N.email&&(0,t.jsx)("p",{className:"text-red-600 mt-1 text-sm",children:N.email.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Password"}),(0,t.jsx)("input",{type:"password",...j("password"),className:"w-full px-4 py-2 mt-1 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent border ".concat(N.password?"border-red-600":"border-[#1b1a40]"),placeholder:"Enter your password"}),N.password&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:N.password.message})]}),(0,t.jsx)("button",{type:"submit",className:"w-full py-2 mt-4 bg-[#1b1a40] text-white rounded-lg font-bold hover:bg-opacity-90 transition duration-200 ".concat(r?"opacity-50 cursor-not-allowed":""),disabled:r,children:r?"Logging in...":"Login"}),a&&(0,t.jsx)("p",{className:"text-red-600 mt-2 text-center",children:a})]})]}),(0,t.jsx)(p,{empId:x,isModalOpen:u,setIsModalOpen:m}),(0,t.jsx)(g.Z,{open:y.open,message:y.message,severity:y.severity,onClose:()=>v(e=>({...e,open:!1}))})]})}},9671:function(e,s,r){"use strict";var t=r(7437);r(2265);var a=r(9175),o=r(5740);s.Z=e=>{let{open:s,message:r,severity:n,onClose:l}=e,i=(e,s)=>{"clickaway"!==s&&l()};return(0,t.jsx)(a.Z,{open:s,autoHideDuration:2e3,onClose:i,children:(0,t.jsx)(o.Z,{onClose:i,severity:n,variant:"filled",sx:{width:"100%"},children:r})})}},5730:function(e,s,r){"use strict";r.d(s,{Sc:function(){return l}});var t=r(1444),a=r(2265);let o=()=>(0,t.I0)(),n=t.v9,l=e=>{let s=o(),r=n(s=>e?e(s):s),t=(0,a.useCallback)(s,[s]),l=(0,a.useMemo)(()=>r,[r]),i=(0,a.useCallback)((e,s)=>t(e(s)),[t]);return{dispatch:t,selector:l,dispatchAction:i}}},6992:function(e,s,r){"use strict";r.d(s,{kS:function(){return i},pH:function(){return n}});var t=r(1116),a=r(8472),o=r(2649);let n=(0,t.hg)("user/loginUser",async(e,s)=>{let{rejectWithValue:r}=s;try{let s=await a.Z.post("http://".concat("ec2-35-173-139-149.compute-1.amazonaws.com","/auth/login"),e,{withCredentials:!0});return o.Z.set("access_token",s.data.access_token),o.Z.set("refresh_token",s.data.refresh_token),o.Z.set("is_Authenticated","true"),console.log("logged in successfully : ",s.data),s.data}catch(e){var t,n;return r((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"Failed to login")}}),l=(0,t.oM)({name:"user",initialState:{userInfo:null,loading:!1,error:null,isAuthenticated:!1,token:null,refresh_token:null,role:null},reducers:{logout:e=>{e.userInfo=null,e.isAuthenticated=!1,e.token=null,e.refresh_token=null,e.error=null,e.role=null,o.Z.remove("access_token"),o.Z.remove("refresh_token")}},extraReducers:e=>{e.addCase(n.pending,e=>{e.loading=!0,e.error=null,e.token=null,e.refresh_token=null,e.role=null}).addCase(n.fulfilled,(e,s)=>{e.loading=!1,e.userInfo={...s.payload.user},e.isAuthenticated=!0,e.token=s.payload.access_token,e.refresh_token=s.payload.refresh_token,e.role=s.payload.role}).addCase(n.rejected,(e,s)=>{e.loading=!1,e.error=s.payload||"Something went wrong"})}}),{logout:i}=l.actions;s.ZP=l.reducer}},function(e){e.O(0,[7034,5907,4186,2280,7583,2427,1116,2971,7023,1744],function(){return e(e.s=8608)}),_N_E=e.O()}]);